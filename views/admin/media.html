{{#> admin/content}}

<div id="app" class="my-3">

    <h2 class="m-3">Media</h2>

    <div class="card">

        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col">Title</th>
                    <th scope="col">Author</th>
                    <th scope="col">Date</th>
                    <th scope="col">Comments</th>
                    <th scope="col">statut</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                {{# medias}}
                <tr>
                    <th scope="row">
                        <a href="/admin/page/edit/{{_id}}" class="btn btn-link">{{title}}</a>
                    </th>
                    <td><a :href="/admin/user/{{userId}}">{{userId}}</a></td>
                    <td>{{createdAt}}</td>
                    <td>{{comments}}</td>
                    <td>Online</td>
                    <td>
                        <button onClick="deletePage('{{_id}}')" class="btn btn-danger btn-sm">Delete</button>
                    </td>
                </tr>
                {{/ medias}}
            </tbody>
        </table>

    </div>

    <input type="file" id="file" accept="image/*">
    <button onClick="addMedia()" class="btn btn-light mt-3">Add</button>

    <form ref='uploadForm' id='uploadForm' action='/API/media/upload' method='post' encType="multipart/form-data">
        <input type="file" name="sampleFile" />
        <input type='submit' value='Upload!' />
    </form>

    <form action="/API/media/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="avatar" />
        <input type='submit' value='Upload!' />
    </form>

</div>

{{/ admin/content}}

<script>

    function addMedia() {
        var fd = new FormData()

        var files = $('#file')[0].files[0];
        // var files = $('#file')[0]

        fd.append('file', files);

        // console.log(fd)

        // $.post(URL + "/API/media/upload", fd, (data, statut) => {
        //     console.log(data)
        // });
        // window.location = "/admin/page/edit/" + data.page._id

        // $.ajax({
        //     url: "/API/media/upload",
        //     data: { sampleFile: fd },
        //     processData: false,
        //     contentType: false,
        //     type: 'POST',
        //     success: function (data) {
        //         console.log(data);
        //     }
        // })

        // var pageTitle = $("#pageTitle").val()
        // var pageName = $("#pageName").val()
        // var pageContent = $("#pageContent").val()
    }


    function editPage(id) {
        window.location = "/admin/page/edit/" + id
    }

    function deletePage(pageId) {
        $.post(URL + "/API/page/delete", { id: pageId }, (data, statut) => {
            console.log(data)
            window.location = "/admin/pages"
        })
    }



    $(() => {

        $(".postTypeSpan").click(function () {
            $(this).hide();
            $(this).next(".postTypeInput").val($(this).text())
            $(this).next(".postTypeInput").show()
            $(this).next(".postTypeInput").focus()
        })

        $(".postTypeInput").focusout(function () {
            $(this).hide();
            $(this).prev().html($(this).val());
            $(this).prev().show();
        });

    })

</script>