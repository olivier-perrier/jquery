{{#> admin/content}}

<div id="appp" class="my-3">

    <h2 class="m-3">Comments</h2>
    
    <div class="m-1">
        <span><a href="/admin/posts">All</a></span> - 
        <span><a href="/admin/posts?status=draft">Draft</a></span> - 
        <span><a href="/admin/posts?authorId={{user._id}}">Mine</a></span> - 
        <span><a href="/admin/posts?status=trash">Trash</a></span>
    </div>

    <div class="border rounded">

        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col">Title</th>
                    <th scope="col">Id</th>
                    <th scope="col">Author</th>
                    <th scope="col">Post</th>
                    <th scope="col">Created</th>
                    <th scope="col">state</th>
                </tr>
            </thead>
            <tbody>
                {{# comments}}
                <tr>
                    <td scope="row">{{title}}</td>
                    <th>
                        <a href="/admin/comments/edit/{{_id}}" class="btn btn-link">{{_id}}</a>
                    </th>
                    <td><a :href="'/admin/user/' + post.authorId">{{authorUsername}}</a></td>
                    <td>{{category}}</td>
                    <td><small>{{tags}}</small></td>
                    <td>{{comments}}</td>
                    <td><small>{{toDate createdAt}}</small></td>
                    <td>
                        <button onClick="deletePost('{{_id}}')" class="btn btn-danger btn-sm">Delete</button>
                    </td>
                </tr>
                {{/ comments}}
            </tbody>
        </table>
    </div>

    <button onClick="createPost()" class="btn btn-light mt-3">Create</button>

</div>


{{/ admin/content}}

<script>

    function createPost() {
        $.post(URL + "/API/posts/create", {}, (data, statut) => {
            console.log(data)
            if (data.post)
                window.location = "/admin/posts/edit/" + data.post._id
        })
    }

    function deletePost(postId) {
        $.post(URL + "/API/posts/trash", { id: postId }, (data, statut) => {
            console.log(data)
            window.location = "/admin/posts"
        })
    }

</script>

<style>
</style>