<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

{{#> admin/content}}

<div id="app">

    <div class="card mt-3">
        <div class="card-header">
            Posts
        </div>





        <ul class="list-group list-group-flush">
            <li v-for="item in posts" class="list-group-item d-flex justify-content-between align-items-center">
                <input type="hidden" id="postId" name="postId" value="post._id">

                <a :href="'/posts/' + item._id">\{{item.title}}</a>
                <input type="text" id="postTags" name="postTags" :value="item.tags">

                <div>
                    <button v-on:click="savePost(item)" class="btn btn-succeess btn-sm">Save</button>
                    <a v-on:click="ediitPost(item)" class="btn btn-primary btn-sm mr-1" :href="'/admin/posts/edit/' + item._id">Edit</a>
                    <button v-on:click="deletePost(item)" class="btn btn-danger btn-sm" href="admin/posts">Delete</button>
                </div>
            </li>
        </ul>

    </div>


    <button v-on:click="createPost()" onClick="createPost()" class="btn btn-light my-2">Create</button>

    <br>

</div>


{{/ admin/content}}

<script>

    function createPost() {
        window.location = "/admin/post/create"
    }

    var app = new Vue({
        el: '#app',
        data: {
            posts: Array(),
        },
        mounted: function () {
            this.getPosts()
        },
        methods: {
            
            savePost: function (post) {
                
                var postTags = $('#postTags').val()

                $.post(URL + "/API/post/save2", { id: postId, tags: postTags }, (data, statut) => {
                    console.log(data)
                })
            },
            getPosts: function () {
                $.get(URL + "/API/posts", (data, statut) => {
                    console.log(data)
                    this.posts = data.posts
                })
            },
            createPost: function () {
                $.post(URL + "/API/posts/create", { name: "salut", content: "salut" }, (data, statut) => {
                    console.log(data)
                    this.posts.push(data.post)
                })
            },
            deletePost: function (post) {

                $.post(URL + "/API/posts/delete/" + post._id, {}, (data, statut) => {
                    console.log(data)
                    this.getPosts()
                })

            },

        }
    })

    $(() => {

    })

</script>