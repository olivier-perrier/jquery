{{> admin/base}}

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

{{> admin/header}}

<div id="app" class="container">
    
    <div class="card">
        <div class="card-header">
            Posts
        </div>
        <ul class="list-group list-group-flush">
            <li v-for="item in posts" class="list-group-item d-flex justify-content-between align-items-center">
                <input type="hidden" id="postId" name="postId" value="post._id">

                {{=%% %%=}}
                <a :href="'/admin/posts/edit/' + item._id">{{item.name}}</a>
                %%={{ }}=%%
                <button v-on:click="deletePost(item)" class="btn btn-danger btn-sm" href="admin/posts">X</button>
                <!-- <span class="badge badge-primary badge-pill">14</span> -->
            </li>
        </ul>

    </div>


    <button v-on:click="createPost()" class="btn btn-light my-2">Create</button>

    <br>

</div>


{{> includes/footer}}

<script>

    var app = new Vue({
        el: '#app',
        data: {
            posts: Array(),
        },
        mounted: function () {
            this.getPosts()
        },
        methods: {
            getPosts: function () {
                $.get(URL + "/API/posts", (data, statut) => {
                    console.log(data)
                    this.posts = data.posts
                })
            },
            createPost: function () {
                $.post(URL + "/API/posts/create", { name: "salut", content: "salut" }, (data, statut) => {
                    console.log(data)
                    this.posts.push(data.post)
                })
            },
            deletePost: function (post) {

                $.post(URL + "/API/posts/delete/" + post._id, {}, (data, statut) => {
                    console.log(data)
                    this.getPosts()
                    // this.posts = data.posts
                })

            },

        }
    })

    $(() => {

    })

</script>