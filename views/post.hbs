{{> header}}

<div class="container py-5">

    <div class="row">

        <div class="col-md-8">

            <article class="mb-5">

                <input type="hidden" id="postId" name="postId" value="{{post._id}}">


                <div class="thumbnail">
                    <img src="/medias/{{post.image}}" alt="Card image cap" class="rounded" width="100%" height="300">
                </div>

                <header class="m-3 mb-3 ml-5">

                    <div class="d-flex justify-content-between">
                        <strong><a href="/author/{{post.authorId}}" class="">{{post.authorUsername}}</a></strong>
                        <small>{{post.createdAt}} ago</small>
                    </div>

                    <h1><a href="/posts/{{post._id}}" class="">{{post.title}}</a></h1>
                </header>

                <div class="body ml-5 p-1 mb-3">
                    <p class="card-text">{{post.content}}</p>
                </div>

                <footer class="pb-3 ml-5">
                    <div class="d-flex justify-content-between">
                        <div>
                            {{# post.tags}}
                            <a href="/tags/{{this}}" class="text-muted text-right">{{this}}</a>
                            {{/ post.tags}}
                        </div>
                        <a href="/categories/{{post.category}}" class="text-muted text-right">{{post.category}}</a>
                    </div>
                </footer>

            </article>

            <div id="container comments">

                <h2>Comments</h2>

                <ul class="list-group list-group-flush">
                    {{# comments}}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between">
                            <strong>{{authorUsername}}</strong>
                            <small>{{createdAt}}</small>
                        </div>
                        <p>{{content}}</p>
                        <div class="text-right">
                            <button class="btn btn-sm btn-light" type="button"
                                onClick="deleteComment('{{_id}}')">Delete</button>
                        </div>
                    </li>

                    {{/ comments}}
                </ul>

                <br>
                <div id="add-comment">
                    <h3>Leave a comment</h3>
                    <textarea class="form-control mb-1" id="commentContent" placeholder="content" rows="3"></textarea>
                    <button class="btn btn-light" type="button" onClick="addComment()">Save</button>
                </div>

            </div>

        </div>

        <div class="col-md-4 sidebar">
            {{> sidebar}}
        </div>

    </div>
</div>


{{> footer}}

<script>

    function addComment() {

        var postId = $('#postId').val()

        var comment = {
            content: $('#commentContent').val(),
            postId: postId,
        }

        $.post(URL + "/API/comments/create", { comment: comment }, (data, statut) => {
            console.log(data)
            console.log(statut)
            window.location.href = "/posts/" + postId //+ "/#add-comment"
        })
    }

    function deleteComment(commentId) {

        var postId = $('#postId').val()

        $.post(URL + "/API/comments/delete", { id: commentId }, (data, statut) => {
            console.log(data)
            window.location = "/posts/" + postId //+ "/#comments"
        })
    }

</script>